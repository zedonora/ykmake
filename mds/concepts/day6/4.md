# 작업 4 개념: DB 기반 동적 메뉴 구현 (개별 글 상세 페이지 로딩 예시)

이 문서에서는 `jobs/day6/4.md`에서 구현한 개별 커뮤니티 글 상세 페이지의 데이터 로딩 과정을 통해 동적 라우트의 데이터 처리 개념을 설명합니다. (실제 동적 메뉴 구현은 다른 작업에서 다룰 수 있습니다.)

## 왜 동적 라우트인가?

*   **재사용성:** `/community/1`, `/community/2` 등 각 게시글마다 별도의 라우트 파일을 만들 필요 없이, `app/routes/community.$postId.tsx` 하나로 모든 게시글 상세 페이지를 처리할 수 있습니다.
*   **유지보수:** 게시글 상세 페이지의 레이아웃이나 로직 변경 시 하나의 파일만 수정하면 됩니다.

## 데이터 로딩 흐름 (`jobs/day6/4.md` 예시)

1.  **URL 파라미터 접근:** 사용자가 `/community/123` 같은 URL로 접속하면, Remix는 `app/routes/community.$postId.tsx` 파일의 `loader` 함수를 실행하고, URL의 동적 세그먼트 값(`123`)을 `params` 객체 (`params.postId`)를 통해 전달합니다.
2.  **입력값 유효성 검사 (Zod):**
    *   `loader` 함수는 가장 먼저 전달받은 `postId`가 유효한 값인지 검증합니다. `jobs/day6/4.md`에서는 **Zod**를 사용하여 `postId`가 양의 정수인지 확인합니다.
    *   유효하지 않은 값이면 오류 응답(예: 400 Bad Request)을 `throw`하여 잘못된 요청임을 알립니다.
3.  **데이터베이스 조회 (Drizzle):**
    *   유효성이 검증된 `postId`를 사용하여 **Drizzle `db` 클라이언트**로 데이터베이스에서 해당 게시글 정보를 조회합니다.
    *   `community_posts` 테이블과 `profiles` 테이블을 `leftJoin`하여 게시글 내용과 작성자 정보를 함께 가져옵니다.
    *   `where(eq(communityPosts.id, postId))` 조건을 사용하여 특정 ID의 게시글만 선택합니다.
    *   `limit(1)`을 사용하여 결과가 하나만 반환되도록 합니다.
4.  **데이터 없음 처리:** 데이터베이스 조회 결과, 해당 `postId`의 게시글이 없으면 404 Not Found 응답을 `throw`합니다.
5.  **데이터 반환 (`Response.json`):**
    *   성공적으로 데이터를 조회하면, 필요한 데이터(게시글 정보, 작성자 정보)를 객체 형태로 구성합니다.
    *   `Response.json()` 함수를 사용하여 이 객체를 JSON 형식의 HTTP 응답 본문으로 만들어 반환합니다. (과거의 `json()` 대신 표준 `Response` 객체 사용)
6.  **프론트엔드 렌더링 (`useLoaderData`):**
    *   페이지 컴포넌트 (`CommunityPostPage`)에서는 Remix의 `useLoaderData` 훅을 사용하여 `loader`가 반환한 JSON 데이터를 가져옵니다.
    *   가져온 데이터를 사용하여 페이지 제목(`meta` 함수), 게시글 제목, 내용, 작성자 정보 등을 화면에 렌더링합니다.

이 과정을 통해 동적 라우트는 URL의 일부를 변수로 사용하여 관련 데이터를 서버에서 안전하게 로드하고, 그 결과를 사용자 인터페이스에 효과적으로 표시할 수 있습니다. 