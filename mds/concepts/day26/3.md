# Day 26: Cloudflare Firewall & 웹 보안 기초

## 개념

### 웹 애플리케이션 방화벽 (Web Application Firewall, WAF)

WAF는 웹 애플리케이션과 인터넷 사용자(클라이언트) 사이에 위치하여, 악의적인 HTTP/S 트래픽을 필터링하고 차단하는 보안 솔루션입니다. 일반적인 네트워크 방화벽이 IP 주소나 포트 번호를 기반으로 트래픽을 제어하는 반면, WAF는 애플리케이션 계층(HTTP 프로토콜)의 내용을 분석하여 다음과 같은 웹 기반 공격을 탐지하고 방어하는 데 특화되어 있습니다.

-   **SQL 인젝션 (SQL Injection):** 악의적인 SQL 구문을 입력하여 데이터베이스를 불법적으로 조작하려는 공격.
-   **크로스 사이트 스크립팅 (Cross-Site Scripting, XSS):** 공격자가 웹사이트에 악성 스크립트를 삽입하여 다른 사용자의 브라우저에서 실행되도록 하는 공격.
-   **크로스 사이트 요청 위조 (Cross-Site Request Forgery, CSRF):** 사용자가 자신의 의지와 무관하게 공격자가 의도한 행위(예: 비밀번호 변경, 글 삭제)를 특정 웹사이트에 요청하게 만드는 공격.
-   **파일 인클루전 (File Inclusion):** 서버 상의 파일을 불법적으로 포함시켜 실행하거나 내용을 유출하는 공격.
-   **기타 OWASP Top 10 취약점 및 알려진 공격 패턴.**

**Cloudflare WAF**는 Cloudflare의 글로벌 엣지 네트워크에서 작동하는 WAF 서비스로, 사용자의 실제 웹 서버 앞에 위치하여 위협 트래픽을 사전에 차단합니다.

### Cloudflare Firewall 주요 기능

Cloudflare는 WAF 기능을 포함하여 다양한 보안 기능을 제공합니다.

-   **관리형 규칙셋 (Managed Rulesets):** Cloudflare 보안 전문가들이 관리하는 최신 공격 패턴 기반의 규칙 모음입니다. 자동으로 알려진 위협을 방어해줍니다. (예: Cloudflare Managed Ruleset, OWASP Core Ruleset)
-   **방화벽 규칙 (Firewall Rules):** 사용자가 직접 트래픽 제어 규칙을 정의할 수 있습니다. IP 주소, 국가, 경로, 헤더, User-Agent, ASN 등 다양한 조건을 조합하여 특정 트래픽을 차단(Block), 허용(Allow), 확인(Challenge - CAPTCHA 등), 또는 로그만 남기도록(Log) 설정할 수 있습니다.
-   **속도 제한 (Rate Limiting):** 특정 경로(예: 로그인 API)에 대해 단위 시간당 요청 횟수를 제한하여 무차별 대입 공격(Brute-force)이나 서비스 거부(DoS) 공격을 완화합니다.
-   **봇 관리 (Bot Management):** 알려진 악성 봇(크롤러, 스캐너 등)을 식별하고 차단하며, 행동 분석을 통해 의심스러운 봇 활동을 관리합니다.
-   **DDoS 보호:** Cloudflare는 네트워크 계층 및 애플리케이션 계층의 분산 서비스 거부(DDoS) 공격을 자동으로 감지하고 방어하는 기능을 제공합니다.
-   **SSL/TLS 암호화:** 웹사이트와 사용자 간의 통신을 암호화하여 데이터 탈취를 방지합니다.

## 웹 보안 기초 원칙

Cloudflare와 같은 외부 보안 솔루션 외에도, 웹 애플리케이션 자체적으로 지켜야 할 기본적인 보안 원칙들이 있습니다.

1.  **입력값 검증 (Input Validation):** 사용자가 입력하는 모든 데이터(폼 데이터, URL 파라미터, HTTP 헤더 등)는 서버 측에서 항상 검증해야 합니다. 예상된 형식, 길이, 타입인지 확인하고, 특수 문자나 스크립트 코드를 적절히 처리(이스케이프, 제거 등)하여 XSS, SQL 인젝션 등의 공격을 방지합니다. (Zod와 같은 라이브러리 활용)
2.  **출력값 이스케이프 (Output Escaping):** 데이터베이스나 사용자 입력에서 가져온 데이터를 HTML 페이지에 표시할 때는 항상 적절하게 이스케이프하여 해당 데이터가 HTML 코드나 JavaScript 코드로 해석되지 않도록 해야 합니다. 이는 XSS 공격을 방지하는 핵심 요소입니다. (React 등 현대 프레임워크는 기본적으로 JSX 내에서 자동 이스케이프를 수행하는 경우가 많습니다.)
3.  **인증 및 인가 (Authentication & Authorization):**
    -   **인증:** 사용자가 누구인지 확인하는 과정입니다. 안전한 비밀번호 저장(해싱, 솔팅), Multi-Factor Authentication (MFA) 등을 사용합니다.
    -   **인가:** 인증된 사용자가 특정 리소스나 기능에 접근할 권한이 있는지 확인하는 과정입니다. 역할 기반 접근 제어(RBAC)나 Supabase RLS와 같은 메커니즘을 사용합니다.
4.  **안전한 세션 관리:** 사용자 로그인 상태를 유지하는 세션 토큰(또는 JWT)은 안전하게 생성, 전송, 저장되어야 하며, 탈취나 위조가 어렵도록 보호해야 합니다. (HttpOnly, Secure, SameSite 쿠키 속성 사용, 짧은 유효 기간 설정 등)
5.  **보안 헤더 사용:** HTTP 응답 헤더에 보안 관련 설정을 추가하여 브라우저 레벨에서 추가적인 보안 계층을 제공합니다. (예: `Content-Security-Policy`, `Strict-Transport-Security`, `X-Content-Type-Options`, `X-Frame-Options`)
6.  **최신 소프트웨어 유지:** 사용하는 프레임워크, 라이브러리, 서버 소프트웨어 등의 보안 패치를 꾸준히 적용하여 알려진 취약점을 해결합니다.
7.  **민감 정보 보호:** 비밀번호, API 키, 개인 정보 등 민감한 데이터는 안전하게 저장(암호화 등)하고, 불필요하게 로그에 남기거나 외부에 노출하지 않습니다.

## 연관성

Cloudflare Firewall과 같은 WAF는 웹 애플리케이션의 **외부 방어선** 역할을 수행하여 알려진 공격 패턴과 악성 트래픽을 효과적으로 차단합니다. 하지만 WAF가 모든 공격을 막을 수는 없으므로, 애플리케이션 **내부적으로도 웹 보안 기초 원칙을 준수**하여 코드 레벨에서 취약점을 제거하고 방어하는 것이 중요합니다. 이 두 가지 보안 계층(외부 WAF + 내부 애플리케이션 보안)을 함께 구축할 때 더욱 강력하고 안전한 웹 서비스를 만들 수 있습니다. 