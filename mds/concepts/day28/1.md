mkdir -p mds/concepts/day28
touch mds/concepts/day28/1.md

# Day 28: 환경 변수 관리

## 개념

환경 변수(Environment Variables)는 애플리케이션 코드 외부에서 설정되어, 애플리케이션 실행 환경(개발, 스테이징, 운영 등)에 따라 달라질 수 있는 설정 값들을 주입하는 데 사용되는 동적인 값입니다. 예를 들어, 데이터베이스 연결 정보, API 키, 비밀 키, 외부 서비스 주소 등은 환경마다 다른 값을 가져야 하며, 이러한 값들을 코드에 직접 작성하는 대신 환경 변수를 통해 관리합니다.

## 핵심 원리 및 중요성

1.  **설정과 코드의 분리 (Separation of Config from Code):** The Twelve-Factor App 방법론의 핵심 원칙 중 하나로, 환경별로 달라지는 설정 값(Config)을 코드 베이스와 완전히 분리합니다. 이를 통해 코드는 변경 없이 다양한 환경에 배포될 수 있습니다.
2.  **보안 강화:** API 키, 데이터베이스 비밀번호, 세션 시크릿 등 민감한 정보를 소스 코드(특히 버전 관리 시스템)에 직접 노출하지 않고 안전하게 관리할 수 있습니다. 운영 환경의 환경 변수는 제한된 인원만 접근할 수 있도록 관리되어야 합니다.
3.  **배포 유연성:** 동일한 코드 빌드를 사용하여 환경 변수만 다르게 설정함으로써 여러 환경(개발, 테스트, 운영 등)에 쉽게 배포할 수 있습니다.
4.  **환경별 동작 제어:** `NODE_ENV`와 같은 환경 변수를 사용하여 특정 환경(예: `production`)에서만 활성화되는 기능(코드 압축, 로깅 레벨 조정, 디버그 정보 숨김 등)을 제어할 수 있습니다.

## 환경 변수 관리 방법

애플리케이션 환경 변수를 관리하는 몇 가지 일반적인 방법이 있습니다.

-   **`.env` 파일:**
    -   프로젝트 루트에 `.env` 파일을 만들고 `KEY=VALUE` 형식으로 환경 변수를 정의합니다.
    -   `dotenv`와 같은 라이브러리를 사용하여 애플리케이션 시작 시 `.env` 파일의 값을 `process.env`로 로드합니다. (Remix는 내장 지원)
    -   **주의:** `.env` 파일은 민감 정보를 포함할 수 있으므로 반드시 `.gitignore`에 추가하여 버전 관리에서 제외해야 합니다. 운영 서버에는 배포 파이프라인을 통해 안전하게 전달되어야 합니다.
-   **플랫폼/호스팅 서비스 환경 변수 설정:**
    -   Vercel, Netlify, AWS (Elastic Beanstalk, Lambda 등), Heroku, Fly.io 등 대부분의 클라우드 호스팅 플랫폼은 자체적인 환경 변수 관리 기능을 제공합니다.
    -   플랫폼의 대시보드나 CLI를 통해 환경 변수를 안전하게 설정하고 관리할 수 있으며, 배포 시 자동으로 애플리케이션에 주입됩니다. **운영 환경에서는 이 방식이 가장 안전하고 권장됩니다.**
-   **시스템 환경 변수:**
    -   서버 운영체제 레벨에서 환경 변수를 직접 설정하는 방식입니다. (예: Linux의 `export KEY=VALUE`)
    -   관리 및 자동화가 번거로울 수 있습니다.
-   **컨테이너 오케스트레이션 (Docker, Kubernetes):**
    -   Docker Compose의 `environment` 또는 `env_file` 옵션, Kubernetes의 `ConfigMap`이나 `Secret`을 사용하여 컨테이너 환경 변수를 관리합니다.

## Remix에서의 환경 변수 처리

Remix 애플리케이션에서는 환경 변수 접근 방식이 서버 측과 클라이언트 측에서 다릅니다.

-   **서버 측 (Loaders, Actions, `entry.server.tsx` 등):**
    -   Node.js 환경에서 실행되므로 `process.env.YOUR_VARIABLE_NAME`을 통해 직접 접근할 수 있습니다.
    -   `.env` 파일에 정의된 변수는 Remix가 자동으로 로드하여 `process.env`에 포함시킵니다. (별도 `dotenv` 설정 불필요)
-   **클라이언트 측 (컴포넌트, `entry.client.tsx` 등):**
    -   보안상의 이유로 서버의 모든 환경 변수가 자동으로 클라이언트에 노출되지 않습니다.
    -   클라이언트에서 사용해야 하는 환경 변수(일반적으로 민감하지 않은 공개 값, 예: `SUPABASE_URL`, `SUPABASE_ANON_KEY`)는 **명시적으로 클라이언트에 전달**해야 합니다.
    -   **방법 1: `loader`를 통해 전달:** `root.tsx` 또는 필요한 라우트의 `loader` 함수에서 `process.env` 값을 읽어 `json` 응답으로 전달하고, 클라이언트 컴포넌트에서 `useLoaderData` 훅을 사용하여 접근합니다. 이 값은 초기 HTML에 포함되어 전달됩니다.
    -   **방법 2: 빌드 시 주입:** Vite 환경에서는 `define` 설정을 사용하여 빌드 시점에 특정 환경 변수 값을 코드에 직접 주입할 수 있습니다. (예: `define: { 'process.env.PUBLIC_VARIABLE': JSON.stringify(process.env.PUBLIC_VARIABLE) }`)

환경 변수를 올바르게 관리하고 사용하는 것은 애플리케이션의 보안, 유연성, 유지보수성을 확보하는 데 매우 중요합니다. 특히 운영 환경에서는 민감 정보 유출을 방지하기 위해 안전한 관리 방법을 선택해야 합니다. 