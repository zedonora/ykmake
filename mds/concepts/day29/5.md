# Day 29: 롤백(Rollback) 개념 및 전략\n\n## 1. 롤백(Rollback)이란?\n\n롤백은 소프트웨어 배포 과정에서, 새로 배포된 버전에 예상치 못한 심각한 문제(예: 치명적인 버그, 서비스 중단, 심각한 성능 저하, 보안 취약점 발견 등)가 발생했을 때, 시스템을 이전에 안정적으로 작동하던 상태(일반적으로 바로 이전 버전)로 되돌리는 프로세스를 의미합니다.\n\n배포는 항상 위험을 수반하며, 아무리 철저하게 테스트를 거쳤더라도 운영 환경의 복잡성으로 인해 예측하지 못한 문제가 발생할 수 있습니다. 롤백은 이러한 상황에서 서비스 중단 시간을 최소화하고 사용자 영향을 줄이기 위한 중요한 안전 장치(Safety Net)입니다.\n\n## 2. 왜 롤백 계획이 중요한가?\n\n-   **서비스 안정성 확보:** 문제가 발생했을 때 빠르게 이전 상태로 복구하여 서비스 중단 시간을 최소화하고 사용자 경험에 미치는 부정적 영향을 줄입니다.\n-   **신속한 장애 대응:** 사전에 정의된 롤백 절차가 있으면 당황하지 않고 침착하고 신속하게 문제 상황에 대응할 수 있습니다.\n-   **위험 관리:** 배포 자체에 내재된 위험을 관리하는 효과적인 수단입니다. 롤백 계획이 있다는 사실만으로도 더 자신감 있게 배포를 진행할 수 있습니다.\n-   **비즈니스 연속성:** 치명적인 문제로 인한 장시간의 서비스 중단은 비즈니스에 직접적인 손실(매출 감소, 고객 이탈, 브랜드 이미지 손상 등)을 초래할 수 있습니다. 롤백은 이러한 손실을 최소화하는 데 기여합니다.\n\n## 3. 롤백 전략\n\n롤백을 수행하는 방식은 사용하는 배포 도구, 플랫폼, 애플리케이션 아키텍처에 따라 다양할 수 있습니다. 몇 가지 일반적인 전략은 다음과 같습니다.\n\n-   **이전 버전 재배포 (Redeploy Previous Version):**\n    -   가장 기본적인 방식으로, 문제가 발생하면 이전의 안정적인 버전 코드를 다시 빌드하고 배포하는 것입니다.\n    -   단점: 빌드 및 배포 시간이 소요되므로 즉각적인 롤백이 어려울 수 있으며, 다운타임이 발생할 수 있습니다.\n-   **블루-그린 배포 (Blue-Green Deployment)에서의 롤백:**\n    -   동일한 운영 환경을 두 개(Blue: 현재 운영 버전, Green: 새로운 버전) 준비하고, 배포 시 Green 환경에 새 버전을 배포하여 테스트합니다.\n    -   문제가 없으면 로드 밸런서(라우터) 설정을 변경하여 트래픽을 Green 환경으로 전환합니다.\n    -   **롤백:** Green 환경에서 문제가 발생하면, 로드 밸런서 설정을 다시 Blue 환경으로 되돌리기만 하면 즉시 롤백이 완료됩니다. 다운타임이 거의 없습니다.\n-   **카나리 배포 (Canary Deployment)에서의 롤백:**\n    -   새로운 버전을 아주 일부 사용자(예: 1%, 5%)에게만 먼저 공개하고, 문제 발생 여부를 모니터링합니다.\n    -   문제가 없다면 점진적으로 더 많은 사용자에게 확대합니다.\n    -   **롤백:** 카나리 버전에서 문제가 발견되면, 해당 버전으로 향하는 트래픽을 즉시 중단하고 모든 트래픽을 이전 버전으로 되돌립니다. 전체 사용자에게 미치는 영향을 최소화하면서 롤백할 수 있습니다.\n-   **인플레이스(In-place) 롤백 (Vercel 방식):**\n    -   Vercel과 같이 불변 배포(Immutable Deployment)를 지원하는 플랫폼에서 사용하는 방식입니다.\n    -   각 배포는 고유한 인스턴스로 존재하며, 프로덕션 트래픽은 현재 활성화된 배포 인스턴스를 가리킵니다.\n    -   **롤백:** 문제가 발생하면, 이전의 안정적인 배포 인스턴스를 새로운 프로덕션 배포로 즉시 승격(Promote)시킵니다. 트래픽 라우팅만 변경되므로 매우 빠르고 다운타임 없이 롤백이 가능합니다.\n\n## 4. 롤백 시 고려사항\n\n-   **데이터베이스 스키마 변경:** 코드 롤백 시 가장 주의해야 할 부분입니다. 새로운 코드와 함께 배포된 데이터베이스 스키마 변경(마이그레이션)은 코드 롤백만으로는 되돌려지지 않습니다.\n    -   **해결 방안:**\n        -   **백업 복원:** 코드 롤백 시점에 맞춰 데이터베이스를 백업 시점으로 복원합니다. (가장 안전)\n        -   **Down 마이그레이션:** 스키마 변경을 되돌리는 마이그레이션 스크립트(Down Migration)를 미리 준비해두고 실행합니다. (Drizzle Kit은 기본 미지원)\n        -   **호환성 유지 설계:** 스키마 변경이 이전 코드 버전과 호환되도록 설계합니다. (예: 필수 컬럼 추가 시 기본값 설정, 삭제 대신 비활성화 플래그 사용 등)\n-   **외부 시스템 연동:** 롤백된 코드가 연동된 외부 시스템(API 등)과 호환되지 않을 수 있습니다.\n-   **롤백 절차 문서화 및 숙지:** 실제 상황에서 당황하지 않도록 롤백 절차를 명확하게 문서화하고, 관련 담당자들이 숙지하고 있어야 합니다.\n-   **롤백 후 검증:** 롤백이 완료된 후에는 이전 버전이 정상적으로 작동하는지 반드시 다시 확인해야 합니다 (Smoke Test 등).\n-   **근본 원인 분석:** 롤백은 임시 조치입니다. 롤백 후에는 반드시 문제가 발생했던 근본 원인을 분석하고 해결하여 동일한 문제가 재발하지 않도록 해야 합니다.\n
## 5. Vercel에서의 롤백\n\nVercel은 불변 배포와 즉시 롤백 기능을 통해 매우 간편하고 빠른 롤백을 지원합니다. Vercel 대시보드의 `Deployments` 탭에서 이전 배포를 찾아 `Promote to Production`을 클릭하는 것만으로 코드 롤백이 가능합니다. 하지만 **데이터베이스 롤백은 Vercel이 자동으로 처리해주지 않으므로**, 이에 대한 계획(주로 백업 복원)을 반드시 별도로 마련해야 합니다.\n
안정적인 서비스 운영을 위해서는 언제든 발생할 수 있는 문제 상황에 대비하여 명확하고 실행 가능한 롤백 계획을 갖추는 것이 필수적입니다.\n``` 