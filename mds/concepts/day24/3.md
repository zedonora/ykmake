# Day 24: Prefetching & clientLoader

## 개념

### Prefetching (프리페칭)

Prefetching은 사용자가 특정 페이지로 이동하기 *전에* 해당 페이지에 필요한 데이터를 미리 로드하는 기술입니다. Remix에서는 `<Link prefetch="intent | render">` 컴포넌트 속성이나 `usePrefetch` 훅을 통해 구현할 수 있습니다. 이를 통해 사용자가 링크를 클릭했을 때 데이터 로딩을 기다리는 시간을 줄여 더 빠르고 부드러운 네비게이션 경험을 제공할 수 있습니다.

-   **Intent Prefetching:** 사용자가 링크 위에 마우스를 올리거나 터치하는 등, 해당 링크로 이동할 *의도*를 보일 때 데이터 로딩을 시작합니다.
-   **Render Prefetching:** 링크 컴포넌트가 화면에 렌더링될 때 즉시 데이터 로딩을 시작합니다.

### clientLoader (클라이언트 로더)

`clientLoader`는 Remix v2에서 도입된 기능으로, 브라우저 환경에서만 실행되는 데이터 로딩 함수입니다. 서버의 `loader` 함수와 유사한 역할을 하지만, 클라이언트 측에서만 데이터를 가져오거나 처리해야 할 때 사용됩니다.

주요 특징 및 용도:

-   **클라이언트 전용 로직:** 브라우저 API(LocalStorage, Geolocation 등) 접근, 클라이언트 측 캐시 활용 등 서버에서는 불가능하거나 비효율적인 작업을 수행할 수 있습니다.
-   **서버 부하 감소:** 서버 렌더링 시에는 실행되지 않으므로, 초기 페이지 로드 성능에 영향을 주지 않고 클라이언트 측에서 필요한 추가 데이터를 로드할 수 있습니다.
-   **서버 `loader` 데이터 접근:** `clientLoader` 내에서 해당 라우트의 서버 `loader`가 반환한 데이터에 접근하여 활용할 수 있습니다.
-   **SPA 경험:** `clientLoader`와 `clientAction`을 함께 사용하면 페이지 전환 없이 클라이언트 측에서 데이터를 로드하고 UI를 업데이트하는 등 SPA(Single Page Application)와 유사한 사용자 경험을 구현할 수 있습니다.

## 핵심 원리

-   **Prefetching:** Remix는 `Link` 컴포넌트의 `prefetch` 속성을 감지하여, 지정된 시점(intent 또는 render)에 해당 라우트의 `loader` 함수를 백그라운드에서 호출합니다. 로드된 데이터는 Remix 내부 캐시에 저장되며, 사용자가 실제로 해당 링크로 이동하면 캐시된 데이터를 사용하여 페이지를 즉시 렌더링합니다.
-   **clientLoader:**
    1.  **초기 로드:** 서버는 `loader`만 실행하여 페이지를 렌더링하고 클라이언트로 전송합니다.
    2.  **하이드레이션:** 클라이언트에서 JavaScript가 로드되고 Remix 애플리케이션이 초기화(하이드레이션)됩니다.
    3.  **`clientLoader` 실행:** 하이드레이션이 완료된 후, 해당 라우트에 `clientLoader`가 정의되어 있으면 Remix가 이를 실행합니다. 이때 서버 `loader`의 데이터가 필요하면 Remix가 제공합니다 (`serverLoader` 인자).
    4.  **데이터 반환 및 UI 업데이트:** `clientLoader`는 필요한 데이터를 로드하거나 계산하여 반환합니다. Remix는 이 데이터를 `useLoaderData` 훅을 통해 컴포넌트에 전달하고, 변경된 데이터로 UI를 업데이트합니다.
    5.  **클라이언트 측 네비게이션:** 사용자가 `clientLoader`가 있는 다른 라우트로 이동하면, 서버를 거치지 않고 브라우저에서 직접 해당 라우트의 `clientLoader`를 실행하여 데이터를 로드하고 페이지를 전환합니다.

## 연관성

Prefetching과 `clientLoader`는 Remix에서 사용자 경험과 성능을 최적화하는 고급 데이터 로딩 전략입니다.

-   Prefetching은 주로 서버 `loader` 데이터를 미리 가져와 **초기 페이지 전환 속도**를 개선하는 데 중점을 둡니다.
-   `clientLoader`는 클라이언트 측에서 데이터를 관리하고 로드하여 **하이드레이션 이후의 동적인 상호작용과 SPA 유사 경험**을 제공하는 데 중점을 둡니다.

이 두 기능을 적절히 조합하면 사용자가 느끼는 애플리케이션의 반응성을 크게 향상시킬 수 있습니다. 