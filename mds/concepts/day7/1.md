# Day 7 - 개념 1: Jobs 스키마, 데이터 로딩 및 UI 표시

`jobs/day7/1.md`에서 구현한 구인 공고(`Jobs`) 기능의 핵심 개념들을 설명합니다.

## 1. Jobs 테이블 스키마 정의 (`app/db/schema.ts`)

Drizzle ORM을 사용하여 PostgreSQL 데이터베이스에 `jobs` 테이블을 정의했습니다.

```typescript
// ... existing code ...
import { pgTable, serial, text, varchar, timestamp, integer } from 'drizzle-orm/pg-core';
import { users } from './users'; // User 스키마 import

export const jobs = pgTable('jobs', {
  id: serial('id').primaryKey(), // 자동 증가하는 기본 키
  userId: integer('user_id').references(() => users.id, { onDelete: 'cascade' }), // users 테이블과의 외래 키 관계 (사용자 삭제 시 관련 job도 삭제)
  title: varchar('title', { length: 255 }).notNull(), // 공고 제목 (최대 255자, 필수)
  description: text('description').notNull(), // 공고 상세 내용 (필수)
  company: varchar('company', { length: 100 }), // 회사명 (최대 100자)
  location: varchar('location', { length: 100 }), // 근무지 (최대 100자)
  url: varchar('url', { length: 255 }), // 관련 링크 (최대 255자)
  category: varchar('category', { length: 50 }), // 분류 (예: '개발', '디자인', 최대 50자)
  createdAt: timestamp('created_at').defaultNow().notNull(), // 생성 시간 (기본값: 현재 시간, 필수)
  updatedAt: timestamp('updated_at').defaultNow().notNull(), // 수정 시간 (기본값: 현재 시간, 필수) - 데이터 변경 추적에 유용
});

// TypeScript 타입 추론 (데이터베이스 작업 시 타입 안전성 확보)
export type Job = typeof jobs.$inferSelect; // SELECT 쿼리 결과 타입
export type NewJob = typeof jobs.$inferInsert; // INSERT 쿼리 입력 타입
// ... existing code ...
```

*   **`pgTable`**: PostgreSQL 테이블 정의 함수입니다.
*   **`serial`**: 자동 증가하는 정수 타입입니다. (`PRIMARY KEY`)
*   **`integer`**: 정수 타입입니다. `references`를 사용하여 `users` 테이블의 `id`를 참조하는 외래 키를 설정했습니다. `onDelete: 'cascade'`는 사용자가 삭제될 때 관련된 `jobs` 데이터도 함께 삭제되도록 합니다.
*   **`varchar`**: 가변 길이 문자열 타입입니다. `length` 옵션으로 최대 길이를 지정합니다.
*   **`text`**: 긴 텍스트를 저장하는 타입입니다.
*   **`timestamp`**: 날짜와 시간을 저장하는 타입입니다. `defaultNow()`는 데이터 생성 시 현재 시간을 기본값으로 설정합니다.
*   **`.notNull()`**: 해당 컬럼이 NULL 값을 허용하지 않도록 설정합니다.
*   **`$inferSelect`, `$inferInsert`**: Drizzle ORM이 스키마 정의로부터 TypeScript 타입을 자동으로 추론하여 제공합니다. 이를 통해 코드 작성 시 타입 오류를 줄이고 개발 생산성을 높일 수 있습니다.

## 2. 서버 측 데이터 로딩 (`loader` 함수 in `app/routes/jobs._index.tsx`)

Remix의 `loader` 함수는 서버에서 실행되어 페이지 렌더링 전에 필요한 데이터를 미리 로드합니다.

```typescript
// ... (imports) ...
import { db } from '~/db/drizzle.server'; // 서버 전용 Drizzle 클라이언트
import { jobs } from '~/db/schema';

export async function loader() {
  // Drizzle 쿼리 빌더를 사용하여 jobs 테이블 조회
  const jobList = await db.query.jobs.findMany({
    orderBy: (jobs, { desc }) => [desc(jobs.createdAt)], // createdAt 컬럼 기준 내림차순(최신순) 정렬
    limit: 20, // 최대 20개의 결과만 가져옴
    // 예시: 특정 조건 필터링
    // where: (jobs, { eq }) => eq(jobs.category, '개발'),
    // 예시: 관계된 사용자 정보 함께 조회 (users 테이블과 관계 설정 필요)
    // with: {
    //   user: { columns: { name: true } } // 사용자 이름만 선택적으로 가져오기
    // }
  });

  // 조회된 데이터를 JSON 형태로 응답 (표준 Response 객체 사용)
  return Response.json({ jobList });
}
// ... (component) ...
```

*   **`db.query.jobs.findMany({...})`**: Drizzle ORM의 타입 안전한 쿼리 빌더를 사용하여 `jobs` 테이블에서 여러 레코드를 조회합니다.
    *   **`orderBy`**: 결과를 정렬하는 기준을 지정합니다. `desc()` 함수를 사용하여 내림차순 정렬합니다.
    *   **`limit`**: 반환될 최대 레코드 수를 제한합니다. 페이지네이션 구현의 기초가 됩니다.
    *   **`where`**: (주석 처리됨) 특정 조건을 만족하는 레코드만 필터링할 때 사용합니다.
    *   **`with`**: (주석 처리됨) 관계가 설정된 다른 테이블의 데이터를 함께 조회할 때 사용합니다 (N+1 문제 방지).
*   **`Response.json({ jobList })`**: Remix v2부터 권장되는 표준 `Response` 객체를 사용하여 데이터를 JSON 형식으로 반환합니다. 이전 버전의 `json()` 유틸리티 함수보다 웹 표준을 따릅니다.

## 3. UI 컴포넌트 및 데이터 표시 (`app/routes/jobs._index.tsx`의 컴포넌트)

`loader` 함수에서 반환된 데이터는 `useLoaderData` 훅을 통해 클라이언트 컴포넌트에서 사용할 수 있습니다. Shadcn UI의 `Card` 컴포넌트를 활용하여 각 구인 공고를 시각적으로 구성합니다.

```typescript
// ... (imports) ...
import { useLoaderData } from '@remix-run/react';
import {
  Card, CardContent, CardDescription, CardHeader, CardTitle
} from '~/components/ui/card'; // Shadcn UI 카드 관련 컴포넌트

export default function JobsIndex() {
  // loader 함수의 반환값 타입(typeof loader)을 제네릭으로 전달하여 타입 안전성 확보
  const { jobList } = useLoaderData<typeof loader>();

  return (
    <div className="container mx-auto py-8 px-4"> {/* Tailwind CSS 유틸리티 클래스 */}
      <h1 className="text-3xl font-bold mb-6 text-center md:text-left">구인 공고</h1>
      <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3"> {/* 반응형 그리드 레이아웃 */}
        {jobList && jobList.length > 0 ? ( // 데이터 존재 여부 확인
          jobList.map((job) => ( // 배열을 순회하며 각 job 데이터를 Card로 렌더링
            <Card key={job.id} className="flex flex-col"> {/* 고유 key prop 필수, flex 레이아웃 */}
              <CardHeader>
                <CardTitle className="text-lg">{job.title}</CardTitle>
                <CardDescription>
                  {/* 조건부 렌더링: 회사 정보가 있으면 표시 */}
                  {job.company ? `${job.company} | ` : ''}
                  {/* 위치 정보가 없으면 기본 텍스트 표시 */}
                  {job.location || '위치 정보 없음'}
                </CardDescription>
              </CardHeader>
              <CardContent className="flex-grow"> {/* 내용 영역이 카드의 남은 공간 차지 */}
                {/* ... (카테고리, 설명, 링크 등) ... */}
                 <a
                    href={job.url}
                    target="_blank" // 새 탭에서 열기
                    rel="noopener noreferrer" // 보안 권장 사항
                    className="text-sm text-rose-600 hover:underline" // Shadcn UI 'rose' 테마 색상 및 hover 효과
                  >
                    공고 바로가기
                  </a>
              </CardContent>
            </Card>
          ))
        ) : (
          // 데이터가 없을 경우 메시지 표시
          <div className="col-span-full text-center text-muted-foreground py-10">
            등록된 구인 공고가 없습니다.
          </div>
        )}
      </div>
    </div>
  );
}
```

*   **`useLoaderData<typeof loader>()`**: `loader` 함수에서 반환된 데이터를 가져옵니다. 제네릭 `<typeof loader>`를 사용하여 반환 데이터의 타입을 명시적으로 지정함으로써, `jobList` 변수의 타입을 추론하고 자동 완성을 지원받을 수 있습니다.
*   **Shadcn UI 컴포넌트 (`Card`, `CardHeader`, `CardTitle`, `CardDescription`, `CardContent`)**: 미리 정의된 스타일과 구조를 가진 컴포넌트를 사용하여 일관성 있고 깔끔한 UI를 쉽게 구축할 수 있습니다. (테마: 'rose')
*   **Tailwind CSS 유틸리티 클래스**: `container`, `mx-auto`, `py-8`, `grid`, `gap-6`, `md:grid-cols-2`, `lg:grid-cols-3` 등 Tailwind CSS 클래스를 직접 사용하여 레이아웃과 스타일링을 적용합니다. 반응형 디자인(`md:`, `lg:`)을 쉽게 구현할 수 있습니다.
*   **조건부 렌더링**: `jobList.length > 0 ? ... : ...` 와 같이 데이터 유무에 따라 다른 UI를 표시합니다. `job.company ? ... : ''` 와 같이 특정 필드의 존재 여부에 따라 다른 내용을 렌더링합니다.
*   **`.map()`**: 배열 데이터를 순회하며 각 항목에 해당하는 React 엘리먼트(여기서는 `Card`)를 생성합니다. 각 엘리먼트에는 고유한 `key` prop을 반드시 제공해야 합니다.
*   **`<a>` 태그**: `target="_blank"`와 `rel="noopener noreferrer"` 속성은 외부 링크를 안전하게 열기 위한 표준적인 방법입니다.

이러한 개념들을 통해 Remix 애플리케이션에서 데이터베이스 상호작용 