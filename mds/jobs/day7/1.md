# 작업 1: Jobs 테이블 스키마 정의 및 데이터 로딩/표시

## 단계

1.  **Jobs 테이블 스키마 정의 (`app/db/schema.ts`):**
    *   구인구직 정보를 저장할 `jobs` 테이블 스키마를 Drizzle ORM으로 정의합니다. (예: `id`, `title`, `company`, `location`, `description`, `url`, `createdAt`, `category` 등)
    *   필요에 따라 `profiles` 또는 `teams` 테이블과의 관계를 설정합니다.

    ```typescript
    // app/db/schema.ts (jobs 테이블 추가)
    import { pgTable, serial, text, timestamp, varchar, uuid /* ...기타 필요한 타입 */ } from 'drizzle-orm/pg-core';
    import { sql } from 'drizzle-orm';
    // import { profiles } from './schema'; // 필요시 import

    // ... 기존 스키마 ...

    export const jobs = pgTable('jobs', {
        id: serial('id').primaryKey(),
        title: varchar('title', { length: 255 }).notNull(),
        company: varchar('company', { length: 255 }),
        location: varchar('location', { length: 100 }),
        description: text('description'),
        url: text('url'), // 지원 URL 등
        category: varchar('category', { length: 50 }), // 카테고리 추가 (예: 'frontend', 'backend', 'design')
        // userId: uuid('user_id').references(() => profiles.id, { onDelete: 'set null' }), // 예시: 작성자 정보 연결
        createdAt: timestamp('created_at', { withTimezone: true }).default(sql`CURRENT_TIMESTAMP`).notNull(),
        // ... 기타 필요한 필드 (급여, 근무 형태 등) ...
    });

    // 필요한 타입 export
    export type Job = typeof jobs.$inferSelect;
    export type NewJob = typeof jobs.$inferInsert;
    ```

2.  **데이터베이스 마이그레이션:**
    *   스키마 변경 사항을 데이터베이스에 적용합니다.

    ```bash
    pnpm drizzle-kit generate
    pnpm drizzle-kit migrate
    ```

3.  **Jobs 목록 라우트 파일 생성:**

    ```bash
    touch app/routes/jobs._index.tsx
    ```

4.  **`loader` 함수 구현 (데이터 로딩):**
    *   `app/routes/jobs._index.tsx`에 `loader` 함수를 작성하여 Drizzle `db` 클라이언트로 `jobs` 테이블 데이터를 조회합니다.
    *   최신순으로 정렬합니다.
    *   `Response.json()`으로 데이터를 반환합니다.

    ```typescript
    // app/routes/jobs._index.tsx
    import { type LoaderFunctionArgs, type MetaFunction } from "@remix-run/node";
    import { useLoaderData } from "@remix-run/react";
    import { db } from "~/lib/drizzle.server";
    import { jobs } from "~/db/schema";
    import type { Job } from "~/db/schema";
    import { desc } from "drizzle-orm";

    export const meta: MetaFunction = () => {
      return [
        { title: "구인구직 | YkMake" },
        { name: "description", content: "YkMake 구인구직 목록" },
      ];
    };

    type LoaderData = {
      jobList: Job[];
    };

    export const loader = async ({ request }: LoaderFunctionArgs) => {
      try {
        const jobList = await db.select()
            .from(jobs)
            .orderBy(desc(jobs.createdAt)); // 최신순 정렬

        return Response.json({ jobList });
      } catch (error) {
        console.error("Error fetching jobs:", error);
        return Response.json({ jobList: [] }, { status: 500 });
      }
    };
    ```

5.  **UI 컴포넌트 구현:**
    *   `useLoaderData`로 구인구직 목록 데이터를 가져옵니다.
    *   목록 형태로 각 구인구직 정보(제목, 회사, 위치 등)를 표시합니다.

    ```typescript
    // app/routes/jobs._index.tsx (Default Export 부분)
    // ... (imports, meta, loader) ...

    export default function JobsIndexPage() {
      const { jobList } = useLoaderData<LoaderData>();

      return (
        <div className="container mx-auto max-w-4xl px-4 py-8">
          <h1 className="text-3xl font-bold mb-6">구인구직</h1>
          {/* TODO: 구인구직 등록 버튼 추가 (권한 필요 시) */} 
          <div className="space-y-4">
            {jobList.length > 0 ? (
              jobList.map((job) => (
                <div key={job.id} className="border p-4 rounded-md shadow-sm">
                  <h2 className="text-xl font-semibold mb-1">{job.title}</h2>
                  <div className="text-sm text-gray-600 mb-2">
                    <span>{job.company}</span>
                    {job.location && <> · <span>{job.location}</span></>}
                  </div>
                  {/* 카테고리 표시 (추가됨) */}
                  {job.category && <span className="inline-block bg-gray-200 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded mb-2">{job.category}</span>} 
                  {/* <p className="text-sm text-gray-800 mb-2 line-clamp-2">{job.description}</p> */}
                  <div className="text-xs text-gray-500 flex justify-between items-center">
                    <span>{job.createdAt ? new Date(job.createdAt).toLocaleDateString() : ''}</span>
                    {job.url && <a href={job.url} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">지원하기</a>}
                  </div>
                   {/* 상세 페이지 링크 (추후 구현) */}
                  {/* <Link to={`/jobs/${job.id}`} className="absolute inset-0" /> */}
                </div>
              ))
            ) : (
              <p className="text-center text-gray-500">등록된 구인구직 정보가 없습니다.</p>
            )}
          </div>
           {/* TODO: 페이지네이션 컴포넌트 추가 */} 
        </div>
      );
    }
    ```

## 완료 확인

*   `app/db/schema.ts`에 `jobs` 테이블 정의가 추가되고, `category` 컬럼이 포함되었는지 확인합니다.
*   Drizzle 마이그레이션이 성공적으로 실행되었는지 확인합니다.
*   (Supabase) 데이터베이스 `jobs` 테이블에 `category` 컬럼이 추가되었는지 확인합니다.
*   `app/routes/jobs._index.tsx` 파일이 생성되고 `loader` 및 UI 컴포넌트가 작성되었는지 확인합니다.
*   `loader` 함수에서 Drizzle을 사용하여 데이터를 조회하고 `Response.json`으로 반환하는지 확인합니다.
*   `/jobs` 경로 접속 시, 구인구직 목록이 최신순으로 표시되고, 각 항목에 카테고리 정보(있다면)가 표시되는지 확인합니다.
*   콘솔 오류가 없는지 확인합니다. 