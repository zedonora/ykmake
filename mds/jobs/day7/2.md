# 작업 2: Team 테이블 스키마 정의 및 데이터 로딩/표시

## 단계

1.  **Teams 테이블 스키마 정의 (`app/db/schema.ts`):**
    *   팀 정보를 저장할 `teams` 테이블 스키마를 Drizzle ORM으로 정의합니다. (예: `id`, `name`, `description`, `logoUrl`, `ownerId`, `createdAt`)
    *   `ownerId`는 팀 소유자를 나타내며, `profiles` 테이블을 참조할 수 있습니다.

    ```typescript
    // app/db/schema.ts (teams 테이블 추가)
    import { pgTable, serial, text, timestamp, varchar, uuid /* ...기타 필요한 타입 */ } from 'drizzle-orm/pg-core';
    import { sql } from 'drizzle-orm';
    import { profiles } from './schema'; // profiles 스키마 import

    // ... 기존 스키마 (profiles, communityPosts, jobs) ...

    export const teams = pgTable('teams', {
        id: serial('id').primaryKey(),
        name: varchar('name', { length: 255 }).notNull(),
        description: text('description'),
        logoUrl: text('logo_url'),
        ownerId: uuid('owner_id').references(() => profiles.id, { onDelete: 'set null' }), // 소유자 정보, 삭제 시 NULL 설정
        createdAt: timestamp('created_at', { withTimezone: true }).default(sql`CURRENT_TIMESTAMP`).notNull(),
        // ... 기타 필요한 필드 (멤버 수 등) ...
    });

    // 필요한 타입 export
    export type Team = typeof teams.$inferSelect;
    export type NewTeam = typeof teams.$inferInsert;
    ```

2.  **데이터베이스 마이그레이션:**
    *   스키마 변경 사항을 데이터베이스에 적용합니다.

    ```bash
    pnpm drizzle-kit generate
    pnpm drizzle-kit migrate
    ```

3.  **Teams 목록 라우트 파일 생성:**

    ```bash
    touch app/routes/teams._index.tsx
    ```

4.  **`loader` 함수 구현 (데이터 로딩):**
    *   `app/routes/teams._index.tsx`에 `loader` 함수를 작성하여 Drizzle `db` 클라이언트로 `teams` 테이블 데이터를 조회합니다.
    *   필요 시 소유자 정보(`profiles`)를 `leftJoin` 합니다.
    *   최신순으로 정렬합니다.
    *   `Response.json()`으로 데이터를 반환합니다.

    ```typescript
    // app/routes/teams._index.tsx
    import { type LoaderFunctionArgs, type MetaFunction } from "@remix-run/node";
    import { useLoaderData } from "@remix-run/react";
    import { db } from "~/lib/drizzle.server";
    import { teams, profiles } from "~/db/schema";
    import type { Team, Profile } from "~/db/schema";
    import { desc, eq } from "drizzle-orm";
    // Shadcn UI Card 등 필요한 컴포넌트 import
    import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "~/components/ui/card";
    import { Avatar, AvatarFallback, AvatarImage } from "~/components/ui/avatar";

    export const meta: MetaFunction = () => {
      return [
        { title: "팀 목록 | YkMake" },
        { name: "description", content: "YkMake 팀 목록" },
      ];
    };

    type LoaderData = {
      teamList: Array<{
        team: Team;
        owner: Pick<Profile, 'username' | 'avatarUrl'> | null;
      }>;
    };

    export const loader = async ({ request }: LoaderFunctionArgs) => {
      try {
        const teamsWithOwner = await db.select({
            team: teams,
            owner: {
                username: profiles.username,
                avatarUrl: profiles.avatarUrl
            }
        })
        .from(teams)
        .leftJoin(profiles, eq(teams.ownerId, profiles.id))
        .orderBy(desc(teams.createdAt)); // 최신순 정렬

        return Response.json({ teamList: teamsWithOwner });
      } catch (error) {
        console.error("Error fetching teams:", error);
        return Response.json({ teamList: [] }, { status: 500 });
      }
    };
    ```

5.  **UI 컴포넌트 구현 (카드 레이아웃):**
    *   `useLoaderData`로 팀 목록 데이터를 가져옵니다.
    *   카드 레이아웃을 사용하여 각 팀 정보(로고, 이름, 설명, 소유자 등)를 표시합니다.

    ```typescript
    // app/routes/teams._index.tsx (Default Export 부분)
    // ... (imports, meta, loader) ...

    export default function TeamsIndexPage() {
      const { teamList } = useLoaderData<LoaderData>();

      return (
        <div className="container mx-auto max-w-6xl px-4 py-8">
          <h1 className="text-3xl font-bold mb-6">팀 목록</h1>
          {/* TODO: 팀 생성 버튼 추가 (권한 필요 시) */} 
          {teamList.length > 0 ? (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {teamList.map(({ team, owner }) => (
                <Card key={team.id} className="flex flex-col">
                  <CardHeader className="flex flex-row items-center gap-4">
                    <Avatar className="h-12 w-12">
                      <AvatarImage src={team.logoUrl ?? undefined} alt={`${team.name} 로고`} />
                      <AvatarFallback>{team.name?.charAt(0).toUpperCase()}</AvatarFallback>
                    </Avatar>
                    <div className="flex-1">
                        <CardTitle className="text-xl">{team.name}</CardTitle>
                        {owner && <p className="text-sm text-muted-foreground">by {owner.username}</p>}
                    </div>
                  </CardHeader>
                  <CardContent className="flex-grow">
                    <p className="text-sm text-muted-foreground line-clamp-3">
                       {team.description || "팀 설명 없음"}
                    </p>
                  </CardContent>
                  <CardFooter className="text-xs text-gray-500">
                     <span>생성일: {team.createdAt ? new Date(team.createdAt).toLocaleDateString() : ''}</span>
                     {/* TODO: 멤버 수 등 추가 정보 */}
                  </CardFooter>
                   {/* 카드 클릭 시 상세 페이지 이동 링크 (추후 구현) */}
                  {/* <Link to={`/teams/${team.id}`} className="absolute inset-0" /> */}
                 </Card>
              ))}
            </div>
          ) : (
            <p className="text-center text-gray-500">등록된 팀이 없습니다.</p>
          )}
          {/* TODO: 페이지네이션 컴포넌트 추가 */} 
        </div>
      );
    }
    ```

## 완료 확인

*   `app/db/schema.ts`에 `teams` 테이블 정의가 추가되었는지 확인합니다.
*   Drizzle 마이그레이션이 성공적으로 실행되었는지 확인합니다.
*   (Supabase) 데이터베이스에 `teams` 테이블이 생성되었는지 확인합니다.
*   `app/routes/teams._index.tsx` 파일이 생성되고 `loader` 및 UI 컴포넌트가 작성되었는지 확인합니다.
*   `loader` 함수에서 Drizzle을 사용하여 데이터를 조회하고 `Response.json`으로 반환하는지 확인합니다.
*   `/teams` 경로 접속 시, 팀 목록이 카드 레이아웃 형태로 최신순으로 표시되는지 확인합니다.
*   콘솔 오류가 없는지 확인합니다. 