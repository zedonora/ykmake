# Day 7 - 작업 4: 로그인 페이지 라우트 구현 (`app/routes/login.tsx`)

이전 단계에서 생성한 `AuthForm` 컴포넌트를 사용하여 실제 로그인 페이지 라우트를 구현합니다. 사용자의 로그인 요청을 처리하고 Supabase를 이용해 인증을 수행하는 `action` 함수와, 폼 상태를 관리하고 `AuthForm`을 렌더링하는 페이지 컴포넌트를 포함합니다.

## 주요 구현 내용

1.  **Meta Function**: 페이지의 메타데이터 (예: `<title>`)를 설정합니다.
2.  **Zod Schema**: 폼 데이터 유효성 검사를 위한 스키마를 정의합니다 (`LoginSchema`).
3.  **Action Function**:
    *   POST 요청으로 받은 폼 데이터를 파싱하고 Zod 스키마로 유효성을 검사합니다.
    *   유효성 검사 실패 시 에러 메시지를 JSON 형식으로 반환합니다.
    *   `createSupabaseServerClient`를 사용하여 서버 환경에서 Supabase 클라이언트를 생성합니다.
    *   `supabase.auth.signInWithPassword`를 호출하여 이메일과 비밀번호로 로그인을 시도합니다.
    *   로그인 성공 시 사용자를 홈페이지(`/`)로 리디렉션하고, 세션 유지를 위해 Supabase 클라이언트에서 반환된 헤더(`headers`)를 응답에 포함합니다.
    *   로그인 실패 시 에러 메시지를 JSON 형식으로 반환합니다.
4.  **Page Component (`LoginPage`)**:
    *   `useActionData` 훅을 사용하여 `action` 함수에서 반환된 데이터(에러 메시지 포함)에 접근합니다.
    *   `useNavigation` 훅을 사용하여 폼 제출 상태(`isSubmitting`)를 확인합니다.
    *   `AuthForm` 컴포넌트를 렌더링하고, `type="login"`, 에러 메시지(`error`), 제출 상태(`pending`)를 props로 전달합니다.

## 코드 (`app/routes/login.tsx`)

```typescript
import { useActionData, useNavigation } from "@remix-run/react";
import { redirect, type ActionFunctionArgs, type MetaFunction } from "@remix-run/node";
import { createSupabaseServerClient } from "~/lib/supabase.server";
import { z } from "zod";
import { AuthForm } from "~/components/custom/auth-form";

export const meta: MetaFunction = () => {
  return [{ title: "로그인 | YkMake" }];
};

const LoginSchema = z.object({
  email: z.string().email("유효한 이메일 주소를 입력해주세요."),
  password: z.string().min(1, "비밀번호를 입력해주세요."),
});

export const action = async ({ request }: ActionFunctionArgs) => {
  const formData = await request.formData();
  const submission = LoginSchema.safeParse(Object.fromEntries(formData));

  if (!submission.success) {
    return Response.json({ error: submission.error.errors[0].message }, { status: 400 });
  }

  const { email, password } = submission.data;
  const { supabase, headers } = await createSupabaseServerClient(request);

  const { error } = await supabase.auth.signInWithPassword({
    email,
    password,
  });

  if (error) {
    console.error("Supabase login error:", error.message);
    return Response.json({ error: "이메일 또는 비밀번호가 잘못되었습니다." }, { status: 401, headers });
  }

  return redirect("/", { headers: headers });
};

export default function LoginPage() {
  const actionData = useActionData<typeof action>();
  const navigation = useNavigation();
  const isSubmitting = navigation.state === "submitting";

  return (
    <AuthForm
      type="login"
      error={actionData?.error}
      pending={isSubmitting}
    />
  );
}
``` 