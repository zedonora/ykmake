# 작업 1: Community Posts 테이블 스키마 정의 및 데이터 로딩/표시

## 단계

1.  **Supabase `community_posts` 테이블 스키마 정의:**
    *   Supabase Studio 또는 SQL 편집기를 사용하여 `community_posts` 테이블을 생성합니다. 필요한 컬럼(예: `id`, `created_at`, `title`, `content`, `user_id`)을 정의하고 RLS 정책을 설정합니다.

    !!!sql
    -- community_posts 테이블 생성 예시
    CREATE TABLE community_posts (
      id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
      created_at TIMESTAMPTZ DEFAULT now() NOT NULL,
      title TEXT NOT NULL,
      content TEXT,
      user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE
    );

    -- RLS 정책 활성화
    ALTER TABLE community_posts ENABLE ROW LEVEL SECURITY;

    -- 정책 예시: 모든 사용자가 게시글 읽기 가능
    CREATE POLICY "Allow read access to everyone" ON community_posts
    FOR SELECT USING (true);

    -- 정책 예시: 인증된 사용자만 게시글 생성 가능
    CREATE POLICY "Allow insert for authenticated users" ON community_posts
    FOR INSERT WITH CHECK (auth.role() = 'authenticated');
    !!!

2.  **커뮤니티 게시글 목록 페이지 라우트 생성:**
    *   `app/routes/community.tsx` 파일을 생성합니다.

    !!!bash
    mkdir -p app/routes
    touch app/routes/community.tsx
    !!!

3.  **`community.tsx` 라우트에서 데이터 로딩 구현:**
    *   `loader` 함수를 사용하여 Supabase에서 `community_posts` 데이터를 가져옵니다. `supabaseAdmin` 클라이언트를 사용합니다.

    !!!typescript
    // app/routes/community.tsx
    import { json, type LoaderFunctionArgs, type MetaFunction } from "@remix-run/node";
    import { useLoaderData } from "@remix-run/react";
    import { supabaseAdmin } from "~/lib/supabase.server"; // 서버 클라이언트 import

    export const meta: MetaFunction = () => {
      return [{ title: "YkMake | 커뮤니티" }];
    };

    export const loader = async ({ request }: LoaderFunctionArgs) => {
      const { data: posts, error } = await supabaseAdmin
        .from("community_posts")
        .select("id, title, created_at") // 필요한 컬럼만 선택
        .order("created_at", { ascending: false }); // 최신순 정렬

      if (error) {
        console.error("Error fetching community posts:", error);
        throw new Response("Error loading posts", { status: 500 });
      }

      return Response.json({ posts }); // Response.json 사용
    };

    export default function CommunityPage() {
      const { posts } = useLoaderData<typeof loader>();

      return (
        <div className="container mx-auto px-4 py-8">
          <h1 className="text-3xl font-bold mb-6">커뮤니티 게시글</h1>
          {posts?.length > 0 ? (
            <ul>
              {posts.map((post) => (
                <li key={post.id} className="mb-2 border-b pb-2">
                  <h2 className="text-xl font-semibold">{post.title}</h2>
                  <p className="text-sm text-gray-500">
                    {new Date(post.created_at).toLocaleDateString()}
                  </p>
                </li>
              ))}
            </ul>
          ) : (
            <p>아직 게시글이 없습니다.</p>
          )}
        </div>
      );
    }
    !!!

## 완료 확인

*   Supabase 프로젝트에 `community_posts` 테이블이 정상적으로 생성되었는지 확인합니다.
*   RLS 정책이 올바르게 설정되었는지 확인합니다 (Studio 또는 SQL 쿼리).
*   `app/routes/community.tsx` 파일이 생성되고 위 코드가 포함되었는지 확인합니다.
*   애플리케이션을 실행하고 `/community` 경로로 접속했을 때, Supabase에 저장된 게시글 목록(또는 "아직 게시글이 없습니다." 메시지)이 정상적으로 표시되는지 확인합니다.
*   오류 발생 시 서버 콘솔 로그를 확인합니다. 